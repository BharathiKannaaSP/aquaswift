FROM node:18

# Enable pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

# Set working dir
WORKDIR /app

# Copy workspace files
COPY tsconfig.base.json ./
COPY pnpm-lock.yaml ./
COPY pnpm-workspace.yaml ./

# Copy entire server folder correctly (as a directory!)
COPY server ./server

# Install dependencies for server
WORKDIR /app/server
RUN pnpm install

# Build server
RUN pnpm build

# Start server
CMD ["node", "dist/index.js"]
